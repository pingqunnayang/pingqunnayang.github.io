---
layout: post
title:  计算机网络学习二
titlename: 计算机网络学习二
date:   2015-11-04 13:48:53 
category: 技术
tags: network TCP IP
description:
---

### 数据链路层

数据链路层使用的信道有以下两种类型:<br>

- 点对点信道。使用一对一的点对点通讯方式。
- 广播信道。使用一对多的广播通信方式。

#### 1.1 点对点信道的数据链路层
链路（link）就是从一个终点到相邻结点的一段物理线路。当需要在一条线路上传输数据时，除了需要一条物理线路外还必须有一些必要的通信协议来控制这些数据的传输，把这些协议的硬件和软件加到链路上，就构成了数据链路。现在最常用的方法是使用网络适配器。
点对点信道的数据链路层的协议数据单元是`帧`。
三个基本问题：<br>

- 封装成帧（framing）
- 透明传输
- 差错检测，CRC（Cyclic Redundancy check）循环冗余检验，链路层不向网络层提供"可靠传输"的服务，链路层只保证最基本的比特差错，不处理类似帧丢失、帧重复、帧失序等错误。这些都是由传输层TCP协议完成。

#### 1.2 点对点协议PPP
PPP协议是目前使用最广泛的数据链路层协议。
**PPP协议需要满足的需求：**

- 简单: 不需要纠错，不需要序号，也不需要流量控制。
- 封装成帧：PPP协议规定特殊的字符作为帧定边界。
- 透明性：如果出现和帧定界符一样的比特流就需要采用有效的措施解决。
- 多种网络层协议：需要支持多种网络层协议（IP和IPX等）。
- 多种类型链路：除了支持多种网络层的协议，还需要能够在多种类型的链路上运行，如串行（一次发送一个比特）或并行，同步或异步，低速或高速的，电的或光的。
- 差错检测（error detection）：需要对接收到的帧进行检测，并立即丢弃有差错的帧。
- 检测连接状态：能够自动检测链路是否处于正常工作状态。
- 最大传送单元：必须对每一种类型的点对点链路设置最大的传送单元MTU的标准默认值。
- 网络层地址协商：必须提供一种机制使通讯的两个网络层的实体能够通过协商知道或能够配置彼此的网络层地址。
- 数据压缩协商：需要提供一种方法来协商使用数据压缩算法。

**PPP协议不需要的功能：**

- 纠错（error collection）：只进行检错，PPP协议是不可靠传输协议。
- 流量控制：tcp负责。
- 序号：PPP是不可靠传输协议，因此不需要使用帧的序号。
- 多点线路：PPP协议不支持多点线路，只支持点对点链路通信。
- 半双工或单工链路：PPP协议只支持全双工链路。

**ppp协议组成**

- 一个将IP数据报封装到串行链路的方法。
- 一个用来建立、配置和测试数据链路连接的链路控制协议LCP（Link Control Protocol）。
- 一套网络控制协议NCP（Network Control Protocol）其中的每一个协议支持不同的网络协议。

**ppp协议帧的格式**

![Alt text](/public/img/technology/network-2.png)

<p style="text-indent: 2em">标志字段就是PPP帧的定界符；地址字段和控制字段最初考虑以后再对这两个字段的值进行其他定义；协议字段2个字节，当协议字段是0x0021时，PPP帧的信息字段就是IP数据报，若为0xC021就是PPP链路控制协议LCP的数据，CRC是帧检验序列FCS。

**ppp协议帧的状态**

<p style="text-indent: 2em">当用户拨号接入ISP后，就建立了一条从用户PC机到ISP的物理连接，这时用户PC机向ISP发送一系列的LCP分组（封装成多个PPP帧），以便建立LCP连接，这些分组及其响应选择了将要使用的一些PPP参数，接着还要进行网络层配置，NCP给新接入的用户PC机分配一个临时的IP地址，这样用户PC机就成为因特网上的一个有IP地址的主机了。
<p style="text-indent: 2em">当用户通讯完毕时，NCP释放网络层连接，收回原来分配出去的IP地址，接着LCP释放数据链路层连接，最后释放的是物理层的连接。

![Alt text](/public/img/technology/network-3.png)

- PPP链路的起始和终止状态永远是图中的`链路静止`状态，这时在用户PC机和ISP的路由器之间并不存在物理层的连接。
- 当用户PC机通过调制解调器呼叫路由器时（通常是在屏幕上用鼠标点击一个连接按钮），路由器就能够检测到调制解调器发出的载波信号，在双方建立了物理层连接后，PPP就进入`链路建立`状态，其目的是建立链路层的LCP连接。
- LCP开始协商一些配置选项，即发送LCP的配置请求帧，链路的另一端发送以下几种响应中的一种，配置确认帧、配置否认帧或者配置拒绝帧。
- 双方建立了LCP链路，接着进入`鉴别`状态，若鉴定身份失败则转到`链路终止`状态，若鉴定成功，则进入『网络层协议』状态。
- 在`网络层协议`状态PPP链路的两端的网络控制协议NCP根据网络层的不同协议互相交换网络层特定的网络控制分组。
- 当网络层配置完毕后，链路就进入数据通信的`链路打开`状态，链路上的两个PPP端点就可以彼此向对方发送分组。还可以发送回送请求LCP分组和回送回答LCP分组，以检查链路的状态。
- 当数据传输结束后，可以由链路的一端发出终止请求LCP分组请求终止链路连接，在收到对方发来的终止确认LCP分组后，转到『链路终止』状态。

#### 1.3 广播信道的数据链路层
<p style="text-indent: 2em">局域网的主要特点是：网络为一个单元所拥有，且地理范围和站点数目均有限。局域网按拓扑进行分类可以分为星形网、环形网、总线网和树形网。
以太网是一种基带总线局域网，它使用CSMA/CD协议，以太网已经在局域网中占据了绝对优势。

>共享信道要着重考虑的一个问题就是如何使众多用户能够合理而方便地共享通信媒体资源，主要有2中方法：<br>
>1.  静态划分信道，如频分复用、时分复用、波分复用和码分复用等。用户只要分配到的信道不与其他用户发生冲突，但这种划分信道的方法代价较高，不适合于局域网使用。 <BR>
>2.  动态媒体接入控制，又称为多点接入，特点是信道并非在用户通信时固定分配给用户，主要有随机接入和受控接入2中方式，以太网使用的是随机接入的方式。

计算机与外界局域网的连接是通过适配器，适配器上装有MAC协议，适配器上也装有处理器和存储器，适配器和局域网之间的通信是通过电缆或双绞线以串行传输方式进行的，而适配器和计算机之间的通信则是通过计算机主板上的I/O总线以并行传输方式进行的。因此适配器的一个重要功能就是要进行数据串行传输和并行传输的转换。适配器接收和发送各种帧时不使用计算机的CPU。

![Alt text](/public/img/technology/network-4.png)

#### 1.4 CSMA/CD协议

总线的特点是：当一台计算机发送数据时，总线上的所有计算机都能检测到这个数据。这就是广播通信方式。但我们不总是要在局域网上进行一对多的广播通讯，为了在总线上实现一对一的通信，可以使每一台计算机的适配器都拥有一个与其他适配器都不同的地址。发送数据帧时，在帧的首部写明接收站的地址。
为了通讯的方便，以太网采取了以下两种措施：

- 采用较为灵活的无连接的工作方式，即不必建立连接就可以直接发送数据。适配器对发送的数据帧不进行编号，也不要求对方发回确认。以太网提供的服务是不可靠的交付，即尽最大努力的交付。
- 以太网发送的数据使用曼切斯特编码的信号。

总线上只要有一台计算机在发送数据，总线的传输资源就被占用，因此，在同一时间只能允许一台计算机发送消息，以太网采用的协调方法是使用一种特殊的协议CSMA/CD，它有以下特点：

- 多点接入：许多计算机以多点接入的方式连接在一根总线上。
- 载波监听：就是"发送前先监听"即适配器边发送数据边检测信道上的信号电压的变化情况，以判断自己在发送数据时其他站是否也在发送数据。
- 碰撞检测：就是"边发送边监听"即适配器边发送数据边检测信道上的信号电压的变化情况，以便判断自己在发送数据时其他站是否也在发送数据。

#### 1.5 扩展以太网

**物理层扩展以太网**
使用物理层的转发器来扩展以太网的地理覆盖范围。

![Alt text](/public/img/technology/network-5.png)

多级结构的集线器给以太网带来一些缺点。
1. 当某个系的两个站在通信时所传送的数据会通过所有的集线器，使的其他系的内部这时也不能用。
2. 如果不同的系使用不同的以太网技术，那么久不可能用集线器将他们互连起来。

**数据链路层扩展以太网**

**网桥实现**
网桥依靠转发表来转发帧。

![Alt text](/public/img/technology/network-6.png)

网桥带来的好处：

- 过滤通信量，增大吞吐量，网桥工作在链路层的MAC子层，可以使以太网各网段成为隔离开的碰撞域。
- 扩大了物理范围。
- 提高了可靠性，当网络故障，一般只会影响个别网段。
- 可互连不同物理层，不同MAC子层和不同速率。

`网桥转发帧时，不改变帧的源地址。`

**透明网桥**
**多接口网桥-以太网交换机**
交换式集线器（switching hub）称为以太网交换机（switch）或者第二层交换机，表明这种交换机工作在数据链路层。当主机需要通信时，交换机能同时连通许多对接口，使每一对相互通信的主机都能独占通讯媒体那样，无碰撞地传输数据。现在很多交换机已混杂了网桥和路由器的功能。

>路由和交换之间的主要区别<br>
交换发生在OSI参考模型的第二层（数据链路层），而路由发生在第三层，即网络层。这一区别决定了路由和交换在移动信息的过程中需要使用不同的控制信息，所以两者实现各自功能的方式是不同的。<br>
<p style="text-indent: 2em">二层交换机是数据链路层的设备，它能够读取数据包中的MAC地址信息并根据MAC地址来进行交换。<br>
交换机内部有一个地址表，这个地址表标明了MAC地址和交换机端口的对应关系。当交换机从某个端口收到一个数据包，它首先读取包头中的源MAC地址，这样它就知道源MAC地址的机器是连在哪个端口上的，它再去读取包头中的目的MAC地址，并在地址表中查找相应的端口，如果表中有与这目的MAC地址对应的端口，则把数据包直接复制到这端口上，如果在表中找不到相应的端口则把数据包广播到所有端口上，当目的机器对源机器回应时，交换机又可以学习一目的MAC地址与哪个端口对应，在下次传送数据时就不再需要对所有端口进行广播了。<br>
<p style="text-indent: 2em">二层交换机就是这样建立和维护它自己的地址表。由于二层交换机一般具有很宽的交换总线带宽，所以可以同时为很多端口进行数据交换。如果二层交换机有N个端口，每个端口的带宽是M，而它的交换机总线带宽超过N×M，那么这交换机就可以实现线速交换。<p style="text-indent: 2em">二层交换机对广播包是不做限制的，把广播包复制到所有端口上。<br>
<p style="text-indent: 2em">二层交换机一般都含有专门用于处理数据包转发的ASIC （Application specific Integrated Circuit）芯片，因此转发速度可以做到非常快。<br>
路由器是在OSI七层网络模型中的第三层——网络层操作的。<br>
<p style="text-indent: 2em">路由器内部有一个路由表，这表标明了如果要去某个地方，下一步应该往哪走。路由器从某个端口收到一个数据包，它首先把链路层的包头去掉（拆包），读取目的IP地址，然后查找路由表，若能确定下一步往哪送，则再加上链路层的包头（打包），把该数据包转发出去；如果不能确定下一步的地址，则向源地址返回一个信息，并把这个数据包丢掉。<br>
<p style="text-indent: 2em">路由技术和二层交换看起来有点相似，其实路由和交换之间的主要区别就是交换发生在OSI参考模型的第二层（数据链路层），而路由发生在第三层。这一区别决定了路由和交换在传送数据的过程中需要使用不同的控制信息，所以两者实现各自功能的方式是不同的。<br>
<p style="text-indent: 2em">路由技术其实是由两项最基本的活动组成，即决定最优路径和传输数据包。其中，数据包的传输相对较为简单和直接，而路由的确定则更加复杂一些。路由算法在路由表中写入各种不同的信息，路由器会根据数据包所要到达的目的地选择最佳路径把数据包发送到可以到达该目的地的下一台路由器处。当下一台路由器接收到该数据包时，也会查看其目标地址，并使用合适的路径继续传送给后面的路由器。依次类推，直到数据包到达最终目的地。











    



